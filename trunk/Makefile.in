######################################################################
# $Id: Makefile.in,v 1.27 1999-02-25 19:26:28 psilord Exp $
######################################################################

SRCS = clear.c drawing.c error.c files.c game.c gpl.c main.c pbests.c play.c sl.c tick.c utils.c
HEADS = sweep.h defaults.h
MISC = README Makefile sweeprc install-sh configure.in Makefile.in config.guess configure config.sub sweep.h.in
TARGET = freesweep
CLEANUP = a.out $(TARGET) core made $(OBJS) config.cache config.log config.status
VERSION = 0.83

SYSTEM_TYPE = @host@
OBJS =  $(patsubst %.c,%.o,$(SRCS))

CC = @CC@
CFLAGS = -Wall -DSYSTEM_TYPE=\"$(SYSTEM_TYPE)\" -DUSER=\"$(USER)\" -DVERSION=\"$(VERSION)\" -DDEBUG_LOG=\"debug.log\" @CFLAGS@ @DEFS@ 
LIBS = @LIBS@
LDFLAGS = @LDFLAGS@

# for systems that have purify
PURE_ARGS = /s/purify/bin/purify -collector=/s/purify/bin/collect2

.SUFFIXES: .c .o
.PHONY: clean sterile lines distclean
#######################################################################
%.o: %.c $(HEADS) Makefile
	@echo Building $<
	@/bin/rm -f $*.o 
	@[ -d $(SYSTEM_TYPE) ]|| mkdir $(SYSTEM_TYPE)
	$(CC) $(CFLAGS) -o $(SYSTEM_TYPE)/$*.o -c $<
	@@LN_S@ $(SYSTEM_TYPE)/$*.o .

$(TARGET): $(OBJS) $(HEADS) $(MISC)
	@echo Linking
	@/bin/rm -f $(TARGET)
	(cd $(SYSTEM_TYPE); $(PURIFY) $(CC) $(CFLAGS) $(OBJS) $(LDFLAGS) $(LIBS) -o $(TARGET))
	@echo "Making symlink to ./$(TARGET)"
	@@LN_S@ $(SYSTEM_TYPE)/$(TARGET) .

configure: configure.in
	@autoconf

clean:
	@-/bin/rm -rf $(CLEANUP) $(SYSTEM_TYPE)

pure:
	@make clean
	@make "PURIFY=$(PURE_ARGS)"

distclean:
	@make sterile

sterile:
	-make clean
	-/bin/rm -f */*.o */core */made */$(TARGET) */a.out sweep.h

tar: $(SRCS) $(MISC)
	(cd ../; tar -cvf $(TARGET)-$(VERSION).tar $(addprefix ./sweep/,$(SRCS) defaults.h $(MISC)))

tags: $(SRCS) $(HEADS) $(MISC)
	@ctags $(SRCS) $(HEADS)

lines: $(SRCS) $(HEADS)
	@echo "Total lines of code:"
	@wc -l $(SRCS) $(HEADS)
